#!/bin/sh

# Auxiliarity function
function unison_sync() {
    # It is important to synchronize the unison profile
    # files first without deletions, that allows the
    # correct deletion of configuration files in the
    # profile `all'.
    #
    # $HOME is the local root of unison.
    unison unison -nodeletion $HOME && unison all && unison unison
    if [ $? -ne 0 ]; then
        exit 1
    fi
}

echo -n "Do you want to synchronize changes? [y/n/d] "

while [ 1 ]
do
    read action
    case $action in

        # Synchronize all changes and start the applications
        # that depend on them.
        "y" )
            unison_sync
            break
            ;;

        # Do not synchronize, but start the applications
        # that depend on synchronization.
        # This option is used if the user is sure that
        # there are no changes.
        "n" )
            break
            ;;

        # Do not synchronize and do not start any
        # applications.
        "d" )
            exit 0
            ;;

        * )
            echo -n "Invalid input! Try again: "
            ;;
    esac
done

unset -f unison_sync

# These applications are started after a successful
# synchronization. It is intended for applications
# that depend on synchronized data.
setsid $HOME/.bin/reload-emacs-config
setsid urxvtc -e hsgtd
setsid $HOME/.bin/org-agenda

